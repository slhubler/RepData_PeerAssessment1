---
title: "Reproducible Research - Project 1"
author: "Shane L Hubler, PhD"
date: "Tuesday, August 12, 2014"
output: html_document
---

# 1 - Preliminaries
### Constant(s) used later:

```{r Libraries}
```

```{r Constants}
# Note that this address has been altered: the "s" was removed from "https"
FILE_HTTP = "http://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
```

### Utility functions:
```{r Utilities}
convert_to_datetime <- function(date.str, interval) {
    interval.str = sprintf("%04i", interval)
    datetime.str = paste(date.str,interval.str)
    datetime = as.POSIXct(datetime.str, format="%Y-%m-%d %H%M",tz="UTC")
    return(datetime)
}

```

### Loading
Data is downloaded using from the link provided in the project description.
The data is loaded directly into memory - the file is not saved on disk.

```{r Loading, cache=TRUE,echo=TRUE}
temp = tempfile()
download.file(url = FILE_HTTP, destfile = temp)
data = read.csv(unz(temp,"activity.csv"))
unlink(temp)
#setwd(DATA_DIR)

```

### Preprocessing
*date* and *interval* are combined into *datetime* (POSIXct format).
The new *time* variable is derived from *datetime*
Note that the column labeled "interval" is a time formatted as HHMM, which
makes it awkward for plotting and requiring more complex handling.

```{r Preprocessing}
data$datetime = mapply(convert_to_datetime,data$date,data$interval,SIMPLIFY=FALSE)

data$time = unlist(mapply(function(a){unlist(format(a,"%H:%M"))}, data$datetime, SIMPLIFY=FALSE))
data$time = as.POSIXct(data$time, format="%H:%M")
#I would love to know a simple way to avoid attaching a date to this value...
```

# 2 - Steps per day

```{r Steps_per_day}
steps.per.day = aggregate(steps~date, data, sum)
hist(steps.per.day$steps,breaks = 10)
steps.per.day.mean = mean(steps.per.day$steps)
steps.per.day.median = median(steps.per.day$steps)
display.mean = sprintf("%.1f", steps.per.day.mean)
display.median = sprintf("%d", steps.per.day.median)
```

The mean and median steps per day, respectively, are

```{r}
display.mean
```

```{r}
display.median
```

# 3 - Daily pattern

```{r Daily_pattern}
steps.per.interval = aggregate(steps~time, data, mean, na.rm=TRUE)
with(steps.per.interval,
     plot(steps~time, 
          main="Mean number of steps per 5-minute interval",
          type = "l")
     )
```

The time with the greatest mean number of steps is

```{r Max_time_of_day}
idx = with(steps.per.interval, 
           which(steps == max(steps,na.rm = rm),)
           )
max.interval = steps.per.interval[idx,]

format(max.interval$time,"%H:%M")
```

# 4 - Imputing missing values

# 5 - Weekdays vs. Weekends